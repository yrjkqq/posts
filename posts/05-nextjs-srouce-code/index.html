<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Next.js 源码阅读 - That's the Way It Is</title><link rel=icon type=image/png href=/posts/img/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:description" content="Next.js 的源码值得一读"><meta name=twitter:description content="Next.js 的源码值得一读"><meta name=description content="Next.js 的源码值得一读"><meta name=description content="Next.js 的源码值得一读"><meta property="og:title" content="Next.js 源码阅读 | That's the Way It Is"><meta name=twitter:title content="Next.js 源码阅读 | That's the Way It Is"><meta property="og:image" content><meta itemprop=name content="Next.js 源码阅读 | That's the Way It Is"><meta name=application-name content="Next.js 源码阅读 | That's the Way It Is"><meta property="og:site_name" content><meta property="og:title" content="Next.js 源码阅读"><meta property="og:description" content="Next.js 的源码值得一读"><meta property="og:type" content="article"><meta property="og:url" content="https://yrjkqq.github.io/posts/posts/05-nextjs-srouce-code/"><meta property="article:published_time" content="2020-05-12T09:45:00+08:00"><meta property="article:modified_time" content="2020-05-12T09:45:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Next.js 源码阅读"><meta name=twitter:description content="Next.js 的源码值得一读"><link href=https://yrjkqq.github.io/posts/css/fonts.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://yrjkqq.github.io/posts/css/main.css><link rel=stylesheet type=text/css href=https://yrjkqq.github.io/posts/css/dark.css media="(prefers-color-scheme: dark)"></head><body><div class=content><header><div class=main><a href=https://yrjkqq.github.io/posts/>That's the Way It Is</a></div><nav><a href=/posts/tags>Tags</a>
<a href=/posts/posts>All</a></nav></header><main><article><div class=title><h1 class=title>Next.js 源码阅读</h1><div class=meta>Posted on May 12, 2020</div></div><section class=body><h1 id=前言>前言</h1><p>Next.js 官方文档不是很详细，一些细节部分需要深入到源码中，才能知其所以然。按照<a href=https://github.com/vercel/next.js/blob/canary/contributing.md>官方贡献指南</a> Fork 项目到自己的仓库，然后 clone 下来。以最新的 canary 分支<a href=https://github.com/vercel/next.js/commit/4dbf0d47b0c84b9f39adfaf826d5ee5888c514f7>版本 10.0.1-canary.4</a> 为基础。</p><h1 id=项目结构>项目结构</h1><p>深入到源码之前，先摸清楚整个项目的结构。</p><p>源码中使用 <code>lerna</code> 在 packages 目录下放置了多个包，每个包有自己的 package.json 文件。使用类似 <code>learn run command</code> 的命令时，会同时运行 packages 目录所有包中可以运行该 command 的命令。</p><p>目录结构：</p><ul><li><code>.vscode</code> 目录下放置了 vscode 相关的配置文件。</li><li><code>bench</code> 目录放置了运行 benchmarks 的代码和文档。</li><li><code>docs</code> 目录下是官方文档。</li><li><code>errors</code> 目录下使用了 Next.js 过程中可能会遇到的错误，记录了错误发生的原因和解决方法。</li><li><code>examples</code> 目录下放置了 Next.js 的用法，或是与各种第三方库或框架结合使用的样例代码</li><li><code>packages</code> 源代码目录，后面主要是阅读这里面的代码</li><li><code>test</code> 测试代码和测试用例</li></ul><p>其他比较重要的文件：</p><ul><li><code>.eslintrc.json</code> ESLint 的配置文件</li><li><code>.prettierrc.json</code> Prettier 的配置文件</li><li><code>jest.config.js</code> 测试框架 jest 的配置文件</li><li><code>lerna.json</code> lerna 的配置文件</li><li><code>package.json</code> 包描述文件，记录了所有可以运行的脚本</li></ul><h1 id=阅读前准备>阅读前准备</h1><p>按照官方贡献指南，安装完依赖后，运行 <code>node --inspect packages/next/dist/bin/next dev test/integration/basic</code> 没有报错，然后打开 <code>http://localhost:3000/about</code> 查看页面正常，就安装运行完成。</p><h2 id=如何启动-debug-模式>如何启动 Debug 模式？</h2><p>仓库下 .vscode 目录下有 vscode debugger 的配置文件，可以直接运行 debugger 程序，方便调试。运行 <code>Launch app development</code> debugger 程序，即可使用 vscode 的 debug 模式。</p><p>打开 <code>packages\next\bin\next.ts</code> 文件设置断点，F5 启动调试，进入断点则 debug 模式启动成功。</p><p>如果需要修改代码，需要单独运行 <code>yarn dev</code> 监听文件的变化并自动编译。修改代码保存后，重新编译完成后需要重新 F5 启动调式程序，才可看到修改后的内容。</p><h2 id=如何阅读源代码>如何阅读源代码？</h2><p>原则：<strong>带着问题进行阅读阅读</strong>，将大问题不断分解成小问题，期间遇到不懂或不清楚的内容，及时记录下来问题和实时阅读进度，待问题解决后再回到之前阅读中断的地方继续。</p><h2 id=问题1>问题1：</h2><p>从运行 <code>node --inspect packages/next/dist/bin/next dev test/integration/basic</code> 到打开 <code>http://localhost:3000/about</code> 查看 about 页面，页面显示 <code>About Page</code> 中间发生了什么？可以规划为多少步？</p><h2 id=问题2>问题2：</h2><p>Next.js 如何读取项目配置下的 next.config.js 文件的？其中 webpack 的配置是怎么生效的？</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/posts/tags/javascript>JavaScript</a></li><li><a href=/posts/tags/node>Node</a></li></ul></nav></div></article></main><footer><hr>⚡️
2020 © yrjkqq | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer></div></body></html>