<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>React.isValidElement 如何实现？ - That's the Way It Is</title><link rel=icon type=image/png href=/posts/img/favicon.ico><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:description" content="isValidElement 实现原理一探究竟"><meta name=twitter:description content="isValidElement 实现原理一探究竟"><meta name=description content="isValidElement 实现原理一探究竟"><meta name=description content="isValidElement 实现原理一探究竟"><meta property="og:title" content="React.isValidElement 如何实现？ | That's the Way It Is"><meta name=twitter:title content="React.isValidElement 如何实现？ | That's the Way It Is"><meta property="og:image" content><meta itemprop=name content="React.isValidElement 如何实现？ | That's the Way It Is"><meta name=application-name content="React.isValidElement 如何实现？ | That's the Way It Is"><meta property="og:site_name" content><meta property="og:title" content="React.isValidElement 如何实现？"><meta property="og:description" content="isValidElement 实现原理一探究竟"><meta property="og:type" content="article"><meta property="og:url" content="https://yrjkqq.github.io/posts/posts/14-react-is-valid-element-impl/"><meta property="article:published_time" content="2020-12-06T16:00:00+08:00"><meta property="article:modified_time" content="2020-12-06T16:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="React.isValidElement 如何实现？"><meta name=twitter:description content="isValidElement 实现原理一探究竟"><link href=https://yrjkqq.github.io/posts/css/fonts.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://yrjkqq.github.io/posts/css/main.css><link rel=stylesheet type=text/css href=https://yrjkqq.github.io/posts/css/dark.css media="(prefers-color-scheme: dark)"></head><body><div class=content><header><div class=main><a href=https://yrjkqq.github.io/posts/>That's the Way It Is</a></div><nav><a href=/posts/tags>Tags</a>
<a href=/posts/posts>All</a></nav></header><main><article><div class=title><h1 class=title>React.isValidElement 如何实现？</h1><div class=meta>Posted on Dec 6, 2020</div></div><section class=body><p><code>isValidElement</code> 函数从 <code>packages\react\src\ReactElement.js</code> 导出，其中使用到 $$typeof 判断是否是 ReactElement.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>/**
</span><span style=color:#75715e> * Verifies the object is a ReactElement.
</span><span style=color:#75715e> * See https://reactjs.org/docs/react-api.html#isvalidelement
</span><span style=color:#75715e> * @param {?object} object
</span><span style=color:#75715e> * @return {boolean} True if `object` is a ReactElement.
</span><span style=color:#75715e> * @final
</span><span style=color:#75715e> */</span>
<span style=color:#66d9ef>export</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>isValidElement</span>(<span style=color:#a6e22e>object</span>) {
  <span style=color:#66d9ef>return</span> (
    <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>object</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;object&#39;</span> <span style=color:#f92672>&amp;&amp;</span>
    <span style=color:#a6e22e>object</span> <span style=color:#f92672>!==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span>
    <span style=color:#a6e22e>object</span>.<span style=color:#a6e22e>$$typeof</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>REACT_ELEMENT_TYPE</span>
  );
}
</code></pre></div><p>我们知道，React 中的节点都会使用 React.createElement 创建。<code>createElement</code> 会返回一个 ReactElement</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ReactElement</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span>(<span style=color:#a6e22e>type</span>, <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>ref</span>, <span style=color:#a6e22e>self</span>, <span style=color:#a6e22e>source</span>, <span style=color:#a6e22e>owner</span>, <span style=color:#a6e22e>props</span>) {
  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>element</span> <span style=color:#f92672>=</span> {
    <span style=color:#75715e>// This tag allows us to uniquely identify this as a React Element
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>$$typeof</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>REACT_ELEMENT_TYPE</span>,

    <span style=color:#75715e>// Built-in properties that belong on the element
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>type</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>type</span>,
    <span style=color:#a6e22e>key</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>key</span>,
    <span style=color:#a6e22e>ref</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>ref</span>,
    <span style=color:#a6e22e>props</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>props</span>,

    <span style=color:#75715e>// Record the component responsible for creating this element.
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>_owner</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>owner</span>,
  };
</code></pre></div><p>该方法中，将 $$typeof 指定为 REACT_ELEMENT_TYPE 常量值。</p><p>回到 isValidElement，即可知道只要是 React 创建的节点，都会有一个参数 $$typeof。</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/posts/tags/react>React</a></li></ul></nav></div></article></main><footer><hr>⚡️
2020 © yrjkqq | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer></div></body></html>